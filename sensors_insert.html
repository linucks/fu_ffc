<link rel="stylesheet" type="text/css" media="all" href="http://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css"/>
<link rel="stylesheet" type="text/css" media="all" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"/>
<script stype="text/javascript" src="https://cdn.jsdelivr.net/npm/moment@2.24.0/moment.min.js"></script>
<script stype="text/javascript" src="http://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
<script stype="text/javascript" src="https://cdn.jsdelivr.net/npm/chartist-plugin-axistitle@0.0.4/dist/chartist-plugin-axistitle.min.js"></script>
<style>
#temp_chart {
  width: 400px;
  float: left;
}
#light_chart {
  width: 400px;
  float: left;
}
</style>

<div id="temp_chart" class="ct-chart ct-perfect-fourth" data-x-axis="Time (hours)" data-y-axis="Temperature (C)"></div>
<div id="light_chart" class="ct-chart ct-perfect-fourth" data-x-axis="Time (hours)" data-y-axis="Light"></div>
<div id="log"></div>

<script>
  drawChart(temp_data, '#temp_chart', 'Temperature (C)');
  drawChart(light_data, '#light_chart', 'Lumens');

  function drawChart(data, chart_id, yAxisTitle) {

    var chartist_options = {
        plugins: [
            Chartist.plugins.ctAxisTitle({
              axisX: {
                axisTitle: 'Day',
                axisClass: 'ct-axis-title',
                offset: {
                  x: 0,
                  y: 32
                },
                textAnchor: 'middle'
              },
              axisY: {
                axisTitle: yAxisTitle,
                axisClass: 'ct-axis-title',
                offset: {
                  x: 0,
                  y: 11
                },
                textAnchor: 'middle',
                flipTitle: true
              }
            })
          ],
      axisX: {
        type: Chartist.FixedScaleAxis,
        divisor: 5,
        labelInterpolationFnc: function(value, x, y) {
          return moment(value).format('MMM D');
        }
      }
    };

    var time_data = dataToDateSeries(data);
    //document.getElementById('log').innerHTML =  'dataX = ' + JSON.stringify(time_data, undefined, 2);
    var temp_chart = new Chartist.Line(chart_id, time_data, chartist_options);
  }

  function dataToDateSeries(data) {
    var new_series = [{
      name: 'ticks',
      data: []
    }];
    for (i = 0; i < data['labels'].length; i++) {
      // Need to multiply dates by 1000 to deal with difference between PHP and JS UTC timestamps
      let ddate = new Date(data['labels'][i] * 1000);
      new_series[0].data.push({
        x: ddate,
        y: data['series'][0][i]
      });
    };
    data.series = new_series;
    return data;
  }

</script>
